# CVE-2024-6387

[!] Not Tested...

Vulnerability Info:  
[Espa√±ol](https://www.incibe.es/incibe-cert/alerta-temprana/avisos/regresshion-vulnerabilidad-rce-en-servidor-openssh)
[English](https://blog.qualys.com/vulnerabilities-threat-research/2024/07/01/regresshion-remote-unauthenticated-code-execution-vulnerability-in-openssh-server)

## About The PoC

### Constants and Variables

Several constants and variables are defined, including:

MAX_PACKET_SIZE: the maximum size of a packet that can be sent.
LOGIN_GRACE_TIME: the grace time for login.
MAX_STARTUPS: the maximum number of login attempts.
CHUNK_ALIGN: a lambda function used to align data in 16-byte blocks.
GLIBC_BASES: a list of possible base addresses of the glibc library.
NUM_GLIBC_BASES: the number of possible base addresses of glibc.
shellcode: a placeholder for the actual shellcode that will be used to execute arbitrary code.

### Functions

Several functions are defined to interact with the SSH server:

setup_connection: establishes a connection with the SSH server.
send_packet: sends a packet with a packet type, data, and length.
prepare_heap: sends a series of packets to prepare the server's heap.
time_final_packet: sends a packet to measure the server's parsing time.
attempt_race_condition: attempts to exploit the race condition in the server.
measure_response_time: measures the server's response time.
create_public_key_packet: creates a public key packet with a specified size and glibc base.
create_fake_file_structure: creates a fake file structure with a specified size and glibc base.
send_ssh_version: sends the SSH version.
receive_ssh_version: receives the SSH version from the server.
send_kex_init: sends a KEXINIT packet.
receive_kex_init: receives the KEXINIT packet from the server.
perform_ssh_handshake: performs the SSH handshake.

### Main

The main function is the main entry point of the exploit. It:

Reads the command-line arguments (IP address and port of the SSH server).
Attempts to exploit the vulnerability for each possible glibc base address.
Establishes a connection with the SSH server and performs the SSH handshake.
Prepares the server's heap and measures the parsing time.
Attempts to exploit the race condition in the server.
If the exploit is successful, it prints a success message.
In summary, this code is an exploit that attempts to exploit a vulnerability in an SSH server that uses the glibc library. The exploit uses a race condition to execute arbitrary code on the server.


## USAGE

- For testing if vulnerable: 
- Example: `CVE-2024-6387-poc.py 0.0.0.0 22`

```
CVE-2024-4577_nc.sh <IP> <Port>
```
