# CVE-2024-4577

Tested with the help of [@Rijaba1](https://www.twitch.tv/rijaba1).

PHP CGI Argument Injection (CVE-2024-4577) Remote Code Execution PoC
Discovered by: Orange Tsai (@orange_8361) of DEVCORE (@d3vc0r3)

Based on [Tenable](https://www.tenable.com/blog/cve-2024-4577-proof-of-concept-available-for-php-cgi-argument-injection-vulnerability)

Vulnerability Info:  
[Espa√±ol](https://www.incibe.es/incibe-cert/alerta-temprana/vulnerabilidades/cve-2024-4577)
[English](https://cve.mitre.org/cgi-bin/cvename.cgi?name=2024-4577)

## About The PoC

The script takes one or two command-line arguments: a URL and an optional payload.

If only a URL is provided, the script will test the URL for vulnerability to CVE-2024-4577 by sending a specially crafted HTTP request to the URL with various PHP-CGI executable paths. The request sets the `allow_url_include` and `auto_prepend_file` PHP settings to attempt to exploit the vulnerability. The script then checks the response for a specific string to determine if the URL is vulnerable.

If a payload is also provided, the script will attempt to exploit the vulnerability by sending the payload as part of the HTTP request. The payload is expected to be a PHP code snippet that will be executed on the vulnerable server.

## Here's a breakdown of the script:

The end array contains various PHP-CGI executable paths that are used to construct the URLs for testing and exploitation.

The `cve_test` function tests a URL for vulnerability to CVE-2024-4577.

The `cve_exploit` function attempts to exploit a vulnerable URL with a provided payload.

The `usage` function displays the usage instructions for the script.

The script then checks the number of command-line arguments and calls either `cve_test` or `cve_exploit` depending on the number of arguments provided. 


## USAGE

- For testing if vulnerable: 
- Example: `CVE-2024-4577_nc.sh http://test.com`

```
CVE-2024-4577_nc.sh <URL>
```

- For RCE:
- Example: `CVE-2024-4577_nc.sh http://test.com "<?php passthru('systeminfo'); ?>"`

```
CVE-2024-4577_nc.sh <URL> <payload>
```


